stages:
  - build

variables:
  MAVEN_OPTS: "-Dmaven.repo.local=.m2/repository"
  CACHE_PATH: ".m2/repository"

cache:
  key: maven-cache
  paths:
    - $CACHE_PATH

.build_template: &build_template
  stage: build
  script:
    - chmod +x build.sh
    - ./build.sh
  artifacts:
    paths:
      - target/*.jar
    expire_in: 1 day

build_api_gateway:
  <<: *build_template
  tags:
    - factory-monitoring-api
  before_script:
    - cd api-gateway
  only:
    - main

build_auth_server:
  <<: *build_template
  tags:
    - factory-monitoring-api
  before_script:
    - cd auth-server
  only:
    - main

build_config_server:
  <<: *build_template
  tags:
    - factory-monitoring-api
  before_script:
    - cd config-server
  only:
    - main

build_daily_report:
  <<: *build_template
  tags:
    - factory-monitoring-api
  before_script:
    - cd daily-report
  only:
    - main

build_five_minute_report:
  <<: *build_template
  tags:
    - factory-monitoring-api
  before_script:
    - cd five-minute-report
  only:
    - main

build_mail_service:
  <<: *build_template
  tags:
    - factory-monitoring-api
  before_script:
    - cd mail-service
  only:
    - main

build_mode_report:
  <<: *build_template
  tags:
    - factory-monitoring-api
  before_script:
    - cd mode-report
  only:
    - main
